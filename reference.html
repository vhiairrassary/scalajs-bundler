<!DOCTYPE html>
<html class="no-js" lang="eng" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reference</title>
    <link rel="stylesheet" href="theme/css/foundation.min.css">
    <link rel="stylesheet" href="theme/css/app.css">
    
     <link rel="stylesheet" href="theme/highlight.js/styles/github-gist.css">  <link rel="stylesheet" href="theme/css/foundation-icons.custom.css"> 
    
     <link rel="prev" href="getting-started.html"  title="Getting started"  />  <link rel="next" href="cookbook.html"  title="Cookbook"  />  <link rel="start" href="index.html"  title="Introduction"  />  <link rel="toc" href="site-contents.html"  title="Table of Contents"  /> 
  </head>
  <body>
    <div class="expanded row">
      <div class="small-12 medium-12 large-12 columns align-self-top">
        <div class="row">
          
          <header class="large-12 columns align-self-top a_header">
            <div class="row">
              <div class="large-12 columns a_limited top-bar">
                <div class="top-bar-left">
                  <p>scalajs-bundler</p>

                </div>
                <div class="top-bar-right align-right row">
                  
                  
                    <form action="site-search.html" method="get" class="align-right a_search">
                      <input name="q" type="search"  placeholder="Search
" >
                      <button><img alt="&#1F50D;" src="theme/images/search.svg" /></button>
                    </form>
                  
                </div>
              </div>
            </div>
          </header>
          
          <div class="small-12 medium-12 large-12 columns align-self-top a_limited a_main">
            <div class="row">
              
              <main class="columns large-order-2 sections" id="_sections">
                 
  <ul class="menu align-right simple a_navbar a_navbar_top">
    
      
        <li><a href="getting-started.html"  title="Getting started" ><span class="a_foundation_icon"></span>  Previous</a></li>
      
    
      
        <li><a href="cookbook.html"  title="Cookbook" ><span class="a_foundation_icon"></span>  Next</a></li>
      
    
      
        <li><a href="site-contents.html"  title="Table of Contents" ><span class="a_foundation_icon"></span>  Contents</a></li>
      
    
  </ul>
 
                
                <h1 id="reference" class="a_section" data-magellan-target="reference">Reference<a class="a_hlink" href="#reference"></a></h1>
<h2 id="scalajsbundlerplugin" class="a_section" data-magellan-target="scalajsbundlerplugin"><code class="hljs">ScalaJSBundlerPlugin</code><a class="a_hlink" href="#scalajsbundlerplugin"></a></h2>
<p>The <code class="hljs">ScalaJSBundlerPlugin</code> sbt plugin automatically enables <code class="hljs">ScalaJSPlugin</code> on the project. It configures
the kind of output of the project to be <code class="hljs">ModuleKind.CommonJSModule</code>. Finally, it also configures its
execution environment so that npm packages are fetched (by running the <code class="hljs">npm update</code> command in the
project’s target directory) before the project is <code class="hljs">run</code> or <code class="hljs">test</code>ed.</p>
<p>It is also possible to bundle the application and its dependencies into a single .js file by using
the <code class="hljs">webpack</code> task scoped to a Scala.js stage (<code class="hljs">fastOptJS</code> or <code class="hljs">fullOptJS</code>):</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-markdown"><span class="hljs-quote">&gt; fastOptJS::webpack</span>
</code></pre>
</div></div>
<p>The <code class="hljs">webpack</code> task returns a list of artifacts produced by the bundling process.</p>
<h3 id="npm-dependencies" class="a_section" data-magellan-target="npm-dependencies">JavaScript Dependencies<a class="a_hlink" href="#npm-dependencies"></a></h3>
<p>To define the npm packages your project depends on, use the <code class="hljs">npmDependencies</code> key:</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala">npmDependencies in <span class="hljs-type">Compile</span> += <span class="hljs-string">"uuid"</span> -&gt; <span class="hljs-string">"~3.1.0"</span>
</code></pre>
</div></div>
<p>You can also scope dependencies to <code class="hljs">Test</code>:</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala">npmDependencies in <span class="hljs-type">Test</span> += <span class="hljs-string">"jasmine"</span> -&gt; <span class="hljs-string">"2.5.2"</span>
</code></pre>
</div></div>
<blockquote class="note">
<p>Your facades must use
<a href="https://www.scala-js.org/doc/interoperability/facade-types.html#a-nameimporta-imports-from-other-javascript-modules"><code class="hljs">@JSImport</code></a>
in order to work with the npm modules, otherwise you will need some additional configuration, as explained
<a href="cookbook.html#global-namespace">here</a>.</p>
</blockquote>
<p>Last but not least, the <code class="hljs">.js</code> files that are in your classpath and in the <code class="hljs">jsSourceDirectories</code> are automatically
copied to the working directory of the <code class="hljs">node</code> command. This means that you can also <code class="hljs">@JSImport</code> these modules from
your Scala facades (you can see an example
<a href="https://github.com/scalacenter/scalajs-bundler/blob/master/sbt-scalajs-bundler/src/sbt-test/sbt-scalajs-bundler/js-resources/src/main/scala/example/MyModule.scala#L6">here</a>).</p>
<h3 id="jsdom" class="a_section" data-magellan-target="jsdom">jsdom Support for Tests<a class="a_hlink" href="#jsdom"></a></h3>
<p>If your tests execution environment require the DOM, add the following line to your build:</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala">requireJsDomEnv in <span class="hljs-type">Test</span> := <span class="hljs-literal">true</span>
</code></pre>
</div></div>
<p>Then, <code class="hljs">ScalaJSBundlerPlugin</code> will automatically download jsdom and bundle the tests before
their execution so that they can be loaded by jsdom.</p>
<p>You can find an example of project requiring the DOM for its tests
<a href="https://github.com/scalacenter/scalajs-bundler/blob/master/sbt-scalajs-bundler/src/sbt-test/sbt-scalajs-bundler/static/">here</a>.</p>
<h3 id="yarn" class="a_section" data-magellan-target="yarn">Yarn<a class="a_hlink" href="#yarn"></a></h3>
<p>By default, <code class="hljs">npm</code> is used to fetch the dependencies but you can use <a href="https://yarnpkg.com/">Yarn</a> by setting the
<code class="hljs">useYarn</code> key to <code class="hljs">true</code>:</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala">useYarn := <span class="hljs-literal">true</span>
</code></pre>
</div></div>
<p>If your sbt (sub-)project directory contains a <code class="hljs">yarn.lock</code>, it will be used. Else, a new one will be created. You should check <code class="hljs">yarn.lock</code> into source control.</p>
<p>Yarn 0.22.0+ must be available on your machine.</p>
<h3 id="bundling-mode" class="a_section" data-magellan-target="bundling-mode">Bundling Mode<a class="a_hlink" href="#bundling-mode"></a></h3>
<p>Each time you change something in your application source code and compile the project, Scala.js emits a new .js
file that can weigh several MBs if your application is large. Scalajs-bundler provides
a few different options with respect to handling this large output file, controlled by setting the optional
<code class="hljs">webpackBundlingMode</code> key and can be scoped to a Scala.js stage (<code class="hljs">fastOptJS</code> or <code class="hljs">fullOptJS</code>).</p>
<h4 id="bundling-mode-application" class="a_section" data-magellan-target="bundling-mode-application">Application (default)<a class="a_hlink" href="#bundling-mode-application"></a></h4>
<p><code class="hljs">webpackBundlingMode := BundlingMode.Application</code> generates a webpack config that simply processes the Scala.js output file as an
entrypoint. This means that webpack loaders, plugins, etc will work as usual. It also means that webpack will
have to process a very large Scala.Js output file.</p>
<p>Turning this CommonJS module into code executable by web browsers takes time, often upwards of a minute.</p>
<p>Nonetheless, this is identical to what you'd get if were to duplicate your workflow outside scalajs-bundler,
so it remains the default.</p>
<h4 id="bundling-mode-library-only" class="a_section" data-magellan-target="bundling-mode-library-only">Library Only<a class="a_hlink" href="#bundling-mode-library-only"></a></h4>
<p>You can get a much faster “change source and reload application” workflow by setting the
<code class="hljs">webpackBundlingMode := BundlingMode.LibraryOnly()</code> key. This bundling mode avoids having webpack process the entire
Scala.js output, but instead uses webpack to bundle all the javascript dependencies (determined via <code class="hljs">@JSImport</code>
and any changes to the <code class="hljs">webpack.config.js</code>). This is accomplished by setting the webpack <code class="hljs">output.library</code> and
<code class="hljs">output.libraryTarget</code> keys in the webpack.config. By default, this generates a global variable named
<code class="hljs">ScalaJSBundlerLibrary</code>, but if needed, that variable name can be overridden via the <code class="hljs">exportedName</code>
parameter provided to <code class="hljs">BundlingMode.LibraryOnly</code>.</p>
<p>The drawback of this mode is that because the output of Scala.js is not processed by Webpack, it is
still a CommonJS module that is not directly executable by web browsers. This problem is addressed
by including a special “loader” before including the Scala.js module.</p>
<blockquote class="warning">
<p>The inclusion of a CommonJS module in the web browser is not guaranteed to work. In particular,
in <code class="hljs">fullOptJS</code> mode the name mangler might produce names that could clash with other existing
global names. For this reason, we don’t recommend using the <code class="hljs">LibraryOnly</code> bundling mode in <code class="hljs">fullOptJS</code>,
or in production.</p>
</blockquote>
<p>In order to use this mode, instead of including <code class="hljs">yourapp-bundle.js</code> in your page, you will need to include
<code class="hljs">yourapp-library.js</code> (which contains all the application libraries bundled into a single file),
<code class="hljs">yourapp-loader.js</code> (which contains a hack to make the application work), and <code class="hljs">yourapp-fastopt.js</code> or
<code class="hljs">yourapp-opt.js</code> (which contains the output of Scala.js, that is a CommonJS module). If you're using Play
Framework, you could use a twirl template similar to this one:</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-html">@(projectName: String,
  assets: String =&gt; String,
  resourceExists: String =&gt; Boolean,
  htmlAttributes: Html = Html("")
)

@defining(s"${projectName.toLowerCase}") { name =&gt;
  @Seq(s"$name-opt-library.js", s"$name-fastopt-library.js").find(resourceExists).map(name =&gt; jsScript(assets(name), htmlAttributes))
}
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"JavaScript"</span>&gt;</span><span class="undefined">
var exports = window;
exports.require = window["ScalaJSBundlerLibrary"].require;
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
@defining(s"${projectName.toLowerCase}") { name =&gt;
  @Seq(s"$name-opt.js", s"$name-fastopt.js").find(resourceExists).map(name =&gt; jsScript(assets(name), htmlAttributes))
}
</code></pre>
</div></div>
<p>The default variable global for the library is <code class="hljs">ScalaJsBundlerDependencies</code>. Should you need to change it,
you can provide a new variable name to the configuration, such as <code class="hljs">webpackBundlingMode := BundlingMode.LibrariesOnly(&quot;myLib&quot;)</code>.</p>
<h5 id="benefits" class="a_section" data-magellan-target="benefits">Benefits<a class="a_hlink" href="#benefits"></a></h5>
<p>By avoiding processing the entire Scala.js output file, webpack times from 10's of seconds to minutes to
a couple of seconds, depending on how many dependencies webpack has to resolve. In addition, since the
module references are all still managed by webpack, any custom loaders such as the <code class="hljs">html-loader</code> or <code class="hljs">text-loader</code>
will work as usual. Other webpack configuration such as external modules also work out of the box.</p>
<p>By splitting the output into a separate library and Scala.js app we are able to leverage browser caching for most
reloads, since it's seldom that both .js assets and Scala.js assets change at the same time.</p>
<p>By avoiding any post-processing of the Scala.js output, we leave the sourcemap generated by the Scala.js compiler
entirely intact. This means we avoid any translation or lookup errors introduced by webpack, and also means
we save a bunch more processing time even if sourcemaps are enabled.</p>
<h5 id="how-it-works" class="a_section" data-magellan-target="how-it-works">How It Works<a class="a_hlink" href="#how-it-works"></a></h5>
<p>Scalajs-bundler has a unique advantage in the JavaScript build ecosystem in that it runs inside SBT and has
access to the Scala.Js compiler internals. By leveraging these, we can generate a fake <code class="hljs">entrypoint.js</code> file that
represents all the <code class="hljs">@JSImport</code>s from a Scala.JS project. We can use this entrypoint to generate a library file
that provides access to all those imports without webpack having to ever process the entire Scala.js output.</p>
<p>Inside the <code class="hljs">entrypoint.js</code> file we also provide a trivial <code class="hljs">require</code> implementation that provides access to the
modules which were imported.</p>
<p>All that remains is to provide an <code class="hljs">exports</code> variable with a reference to the <code class="hljs">require</code> implementation
for the Scala.js out to hang onto, which is what the loader provides.</p>
<h4 id="bundling-mode-library-and-application" class="a_section" data-magellan-target="bundling-mode-library-and-application">Library and Application<a class="a_hlink" href="#bundling-mode-library-and-application"></a></h4>
<p><code class="hljs">bundlingMode := BundlingMode.LibraryAndApplication()</code> builds on <code class="hljs">BundlingMode.LibraryOnly</code> and attempts to
produce only one artifact (like the <code class="hljs">Application</code> bundling mode) without the overhead processing the entire
Scala.js output file.
It uses the same library file generation process as <code class="hljs">BundlingMode.LibraryOnly</code>. It then bundles that library,
the loader, and the Scala.js output into a <code class="hljs">yourapp-bundle</code> file by concatenating them. If <code class="hljs">enableSourceMaps := true</code>,
it will attempt to use the node.js <code class="hljs">concat-with-sourcemaps</code> module to combine the sourcemaps as well.</p>
<p>If you need interoperability with the full <code class="hljs">Application</code> mode or somehow can't handle the two files generated
by the <code class="hljs">LibraryOnly()</code> mode, this mode may be useful for you. However, it relies on post-processing and eliminates
some of the benefits of the <code class="hljs">LibraryOnly</code> mode, so consider carefully if you really need it before turning it on.</p>
<h3 id="tasks-and-settings" class="a_section" data-magellan-target="tasks-and-settings">Tasks and Settings<a class="a_hlink" href="#tasks-and-settings"></a></h3>
<p>The tasks and settings that control the plugin are documented in the API documentation
of the <a href="api/latest/index.html#scalajsbundler.sbtplugin.ScalaJSBundlerPlugin$">ScalaJSBundlerPlugin</a>.</p>
<h2 id="webscalajsbundlerplugin" class="a_section" data-magellan-target="webscalajsbundlerplugin"><code class="hljs">WebScalaJSBundlerPlugin</code><a class="a_hlink" href="#webscalajsbundlerplugin"></a></h2>
<p>The <code class="hljs">WebScalaJSBundlerPlugin</code> provides integration with <a href="https://github.com/vmunier/sbt-web-scalajs">sbt-web-scalajs</a>.
Enable this plugin on JVM projects that need to use .js artifacts produced by Scala.js projects (ie in places
where you used to enable <code class="hljs">WebScalaJS</code>).</p>
<p>The plugin tunes the <code class="hljs">scalaJSPipeline</code> to use the bundles produced by webpack rather than the direct
output of the Scala.js compilation.</p>
<h3 id="npm-assets" class="a_section" data-magellan-target="npm-assets">Importing Assets from NPM Packages<a class="a_hlink" href="#npm-assets"></a></h3>
<p>Some NPM packages also contain static assets (e.g. fonts, stylesheets, images, etc.). You can make them available
as sbt-web assets as follows:</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala">npmAssets ++= <span class="hljs-type">NpmAssets</span>.ofProject(client) { nodeModules =&gt;
  (nodeModules / <span class="hljs-string">"font-awesome"</span>).allPaths <span class="hljs-comment">// sbt 1.0.0+</span>
}.value
</code></pre>
</div></div>
<blockquote>
<p>Note: for older sbt versions use <code class="hljs">(nodeModules / &quot;font-awesome&quot;).***</code> instead.</p>
</blockquote>
<p>Where <code class="hljs">client</code> is the identifier of an sbt project that uses the <code class="hljs">ScalaJSBundlerPlugin</code>. The above configuration
makes all the files within the <code class="hljs">font-awesome</code> package available as sbt-web assets.
These assets keep their path prefix relative to the <code class="hljs">node_modules</code> directory: for instance the asset path of the
<code class="hljs">css/font-awesome.min.css</code> resource is <code class="hljs">font-awesome/css/font-awesome.min.css</code>.</p>
<h3 id="web-tasks-and-settings" class="a_section" data-magellan-target="web-tasks-and-settings">Tasks and Settings<a class="a_hlink" href="#web-tasks-and-settings"></a></h3>
<p>The tasks and settings that control the plugin are documented in the API documentation
of the <a href="api/latest/index.html#scalajsbundler.sbtplugin.WebScalaJSBundlerPlugin$">WebScalaJSBundlerPlugin</a>.</p>

                 
  <ul class="menu align-right simple a_navbar a_navbar_bottom">
    
      
        <li><a href="getting-started.html"  title="Getting started" ><span class="a_foundation_icon"></span>  Previous</a></li>
      
    
      
        <li><a href="cookbook.html"  title="Cookbook" ><span class="a_foundation_icon"></span>  Next</a></li>
      
    
      
        <li><a href="site-contents.html"  title="Table of Contents" ><span class="a_foundation_icon"></span>  Contents</a></li>
      
    
  </ul>
 
              </main>
              
              
                <div data-sticky-container class="small-12 medium-12 large-2 large-order-1 columns a_sitenav_container">
                  <nav class="a_sitenav" data-sticky data-sticky-on="large" data-anchor="_sections">
                    
                    <ul>
                       
  <li >
    
      
        <a href="index.html">Introduction</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="motivation.html">Motivation</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="getting-started.html">Getting started</a>
      
    
    
  </li>
  
  <li  class="a_thispage" >
    
      
        <a href="reference.html">Reference</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="cookbook.html">Cookbook</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="community.html">Community</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="changelog.html">Changelog</a>
      
    
    
  </li>
 
                    </ul>
                    
                    
                  </nav>
                </div>
              
              
              
                <div class="small-12 medium-12 large-2 large-order-3 columns a_show-for-xlarge" data-sticky-container>
                  <nav class="a_pagenav" data-sticky data-sticky-on="large" data-anchor="_sections">
                     <header><p>On This Page</p>
</header> 
                    <ul class="vertical menu" data-magellan>
                       
  
    <li>
      
         <a href="#reference">Reference</a> 
      
      
        <ul class="vertical menu">  
  
    <li>
      
         <a href="#scalajsbundlerplugin">ScalaJSBundlerPlugin</a> 
      
      
        <ul class="vertical menu">  
  
    <li>
      
         <a href="#npm-dependencies">JavaScript Dependencies</a> 
      
      
    </li>
  
  
  
    <li>
      
         <a href="#jsdom">jsdom Support for Tests</a> 
      
      
    </li>
  
  
  
    <li>
      
         <a href="#yarn">Yarn</a> 
      
      
    </li>
  
  
  
    <li>
      
         <a href="#bundling-mode">Bundling Mode</a> 
      
      
        <ul class="vertical menu">  
  
    <li>
      
         <a href="#bundling-mode-application">Application (default)</a> 
      
      
    </li>
  
  
  
    <li>
      
         <a href="#bundling-mode-library-only">Library Only</a> 
      
      
        <ul class="vertical menu">  
  
    <li>
      
         <a href="#benefits">Benefits</a> 
      
      
    </li>
  
  
  
    <li>
      
         <a href="#how-it-works">How It Works</a> 
      
      
    </li>
  
  </ul>
      
    </li>
  
  
  
    <li>
      
         <a href="#bundling-mode-library-and-application">Library and Application</a> 
      
      
    </li>
  
  </ul>
      
    </li>
  
  
  
    <li>
      
         <a href="#tasks-and-settings">Tasks and Settings</a> 
      
      
    </li>
  
  </ul>
      
    </li>
  
  
  
    <li>
      
         <a href="#webscalajsbundlerplugin">WebScalaJSBundlerPlugin</a> 
      
      
        <ul class="vertical menu">  
  
    <li>
      
         <a href="#npm-assets">Importing Assets from NPM Packages</a> 
      
      
    </li>
  
  
  
    <li>
      
         <a href="#web-tasks-and-settings">Tasks and Settings</a> 
      
      
    </li>
  
  </ul>
      
    </li>
  
  </ul>
      
    </li>
  
 
                    </ul>
                  </nav>
                </div>
              
            </div>
          </div>
        </div>
      </div>
      
      <footer class="small-12 medium-12 large-12 columns align-self-bottom a_footer">
        <div class="row">
          <div class="small-12 medium-12 large-12 columns top-bar">
            <div class="top-bar-left">
              
            </div>
            <div class="top-bar-right">
              <p>Generated with <a href="https://github.com/szeiger/ornate">Ornate</a>.</p>

            </div>
          </div>
        </div>
      </footer>
    </div>
    
    <script src="theme/js/jquery.min.js"></script>
    <script src="theme/js/what-input.min.js"></script>
    <script src="theme/js/foundation.min.js"></script>
    
    <script src="theme/js/app.js"></script>
    
  </body>
</html>
